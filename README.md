# howto_fmriprep
Полный гид по обработке рестов в fmriprep


# Этапы
1. Организация папки с сырыми данными в BIDS формате
2. Необходимые файлы для fmriprep
3. Запуск скрипта fmriprep
4. Денойзинг и экстракция временных рядов

## 1 Организация данных в BIDS
![](https://andysbrainbook.readthedocs.io/en/latest/_images/BIDS.png "")
Я пробовала использовать какие-то утилиты, которые автоматически все переименовывают и организуют в соответствии с документацией BIDS, но их очень сложно заводить, они постоянно на что-то ругаются. [Вот тут есть много ссылок на них.](https://andysbrainbook.readthedocs.io/en/latest/OpenScience/OS/BIDS_Overview.html)

Поэтому оптимальный вариант, как мне кажется, привести папку с датасетом в минимальный а-ля BIDS вид, чтобы fmriprep (и другие штуки, использующие BIDS) не ругались. 
Для этого я переименовываю все папки и файлы как показано в примерах BIDS. Сделать универсальный код пока не дошли руки, делаю все каждый раз заново.

Главное для resting state fMRI:
1. Для каждого человека своя папка, название которой начинается с `sub-N`, где N - совершенно любой идентификатор
2. Внутри папки человека еще 2 папки: `anat` и `func`
3. В папке `anat` структурный файл с названием `sub-N_T1w.nii`
4. В папке `func` функциональные 4d файлы `sub-N_task-rest_run-1_bold.nii` (не уверена, будет ли работать с кучей 3d файлов вместо одного, потому что во всех примерах один файл на каждый ран). Здесь нужно обратить внимание на то, что есть в названии. 

## 2 Необходимые файлы

## 3 Запуск скрипта 

fmriprep доступен как приложение внутри докер-контейнера. 

Пример bash скрипта для запуска докера с fmriprep на сервере:

```
docker run -i --rm \
    -v /data/path:/data:ro \ 
    -v /data/path/derivatives:/out \
    -v /another/path/work:/work \
    -v /home/path:/license \
    nipreps/fmriprep \
    /data /out participant \
    --participant-label sub-18604 sub-49401 sub-33259 \
    --nthreads 32 --fs-license-file /license/license.txt \
    --skull-strip-t1w skip --fs-no-reconall --skip-bids-validation \
    --work-dir /work
```
